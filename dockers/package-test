FROM ubuntu:latest
RUN apt-get update && apt-get install -y build-essential nodejs npm
COPY . /app

WORKDIR /app/packages/net-flip-js
RUN npm install

WORKDIR /app
RUN npm install

RUN gcc -std=c11 -pedantic -Wall -Wextra -Werror -c ./core-lib/libcore.c -o ./libcore.o
RUN gcc -shared -o ./libcore.so ./libcore.o
RUN gcc -std=c11 -pedantic -Wall -Wextra -Werror ./core-test/main.c -Icore-lib -L. -lcore -o ./core-test-app -Wl,-rpath,.

CMD ["npm", "run", "test-package"]
